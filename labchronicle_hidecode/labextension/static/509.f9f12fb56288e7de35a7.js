"use strict";(self.webpackChunkjupyterlab_hidecode=self.webpackChunkjupyterlab_hidecode||[]).push([[509],{509:(e,t,n)=>{n.r(t),n.d(t,{default:()=>b});var o,c=n(324),l=n(766),d=n(816),i=n(262);!function(e){e.toggleActiveCell="jupyterlab-hidecode:toggle-active-cell",e.applyHideTag="jupyterlab-hidecode:apply-hide-tag"}(o||(o={}));const a={autoHideTaggedCells:!0,hideTag:"hide_input"},s="jupyterlabHideCode",r="jp-jupyterlab-hidecode-locked",u="jp-jupyterlab-run-button",p="jp-jupyterlab-run-button-running",h=new WeakMap,g="JupyterLab Hide Code",v={id:"jupyterlab-hidecode:plugin",description:"Hide/show notebook inputs with a Colab-like play button parameter widgets in JupyterLab.",autoStart:!0,requires:[l.INotebookTracker,c.ICommandPalette],optional:[d.ISettingRegistry],activate:(e,t,n,d)=>{console.log("JupyterLab extension jupyterlab-hidecode is activated!");let b={...a};const m=e=>{var n;var o;o=null!==(n=null==e?void 0:e.composite)&&void 0!==n?n:{},b={...a,...null!=o?o:{}},t.forEach(e=>I(e))};d&&d.load(v.id).then(e=>{m(e),e.changed.connect(()=>m(e))}).catch(e=>{console.error("Failed to load settings for jupyterlab-hidecode.",e)});const C=e=>void 0!==e&&i.JSONExt.isObject(e)?i.JSONExt.deepCopy(e):{},y=e=>{const t=e.model.getMetadata(s);return{locked:!0===C(t).locked}},f=(e,t)=>{t.locked?(e.model.setMetadata(s,t),e.node.classList.add(r)):(e.model.deleteMetadata(s),e.node.classList.remove(r))},w=e=>!0===y(e).locked,k=(e,t)=>{const n=e.model.getMetadata("jupyter"),o=C(n);o.source_hidden=t,e.model.setMetadata("jupyter",o)},L=(e,t,n)=>{var o;if(e.inputHidden===t)return k(e,t),void(void 0!==n&&f(e,{locked:n}));e.inputHidden=t,k(e,t);const c=null!==(o=null!=n?n:y(e).locked)&&void 0!==o&&o;f(e,{locked:c})},x=(e,t)=>{const n=t.node.querySelector(".jp-InputCollapser");if(!n){if(!h.has(t)&&!t.isDisposed){const n=new MutationObserver(()=>{if(t.isDisposed)return n.disconnect(),void h.delete(t);t.node.querySelector(".jp-InputCollapser")&&(n.disconnect(),h.delete(t),x(e,t))});n.observe(t.node,{childList:!0,subtree:!0}),h.set(t,n),t.disposed.connect(()=>{n.disconnect(),h.delete(t)})}return}const o=n.querySelector(`.${u}`);let c=null!=o?o:document.createElement("button");if(!o){c.type="button",c.classList.add(u),c.setAttribute("aria-label","Run hidden cell");const o=document.createElement("span");o.classList.add(`${u}-icon`),o.innerHTML="<svg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'><path d='M8 5v14l11-7z'></path></svg>",c.appendChild(o),c.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),(async()=>{try{c.classList.add(p),c.disabled=!0,await(async(e,t)=>{const n=e.content,o=n.widgets.indexOf(t);if(-1===o)return;const c=n.activeCellIndex;n.activeCellIndex=o;try{await e.sessionContext.ready,await l.NotebookActions.run(n,e.sessionContext)}finally{c!==o&&c>=0&&(n.activeCellIndex=c)}})(e,t)}catch(e){console.error("Failed to run hidden cell",e)}finally{c.classList.remove(p),c.disabled=!1,j(e,t)}})()}),n.appendChild(c)}c.style.display=w(t)?"flex":"none"},H=e=>{const n=null!=e?e:t.currentWidget,o=null==n?void 0:n.content,c=null==o?void 0:o.activeCell;if(!n||!c)return;const l=!c.inputHidden;L(c,l,l),x(n,c),n.content.update()},E=(e,t=!0)=>{const n=b.hideTag;n&&(e.content.widgets.forEach(o=>{const c=o.model.getMetadata("tags");(Array.isArray(c)?c:[]).includes(n)&&(L(o,t,!0),x(e,o))}),e.content.update())},I=e=>{b.autoHideTaggedCells&&E(e,!0)},j=(e,t)=>{w(t)?L(t,!0,!0):t.inputHidden||t.node.classList.remove(r),x(e,t)};e.commands.addCommand(o.toggleActiveCell,{label:"Toggle active cell input visibility",caption:"Collapse or expand the current cell input area",execute:()=>H()}),n.addItem({category:g,command:o.toggleActiveCell}),e.commands.addCommand(o.applyHideTag,{label:"Hide cells tagged for JupyterLab Hidecode",caption:"Collapse all cells that contain the configured hide tag",execute:()=>{const e=t.currentWidget;e&&E(e)}}),n.addItem({category:g,command:o.applyHideTag}),t.widgetAdded.connect((e,t)=>{var n,o;const l=new c.ToolbarButton({label:"Show/Hide code",className:"jp-jupyterlab-show-code-button",tooltip:"JupyterLab Hidecode hide/show active cell input",onClick:()=>H(t)});t.toolbar.insertItem(10,"jupyterlabHideInput",l);const d=()=>{const e=t.content.activeCell;e&&j(t,e)},i=()=>{t.content.widgets.forEach(e=>j(t,e))},a=()=>{t.content.widgets.forEach(e=>x(t,e))};t.content.activeCellChanged.connect(d);const s=null!==(o=null===(n=t.content.model)||void 0===n?void 0:n.cells)&&void 0!==o?o:null;let r=null;s&&(r=()=>{requestAnimationFrame(()=>{i(),a()})},s.changed.connect(r));const p=(e=>{const t=t=>{const n=t.target;if(!n)return;if(n.closest(`.${u}`))return;if(!n.closest(".jp-InputPlaceholder")&&!n.closest(".jp-Collapser"))return;const o=n.closest(".jp-Cell");if(!o)return;const c=e.content.widgets.find(e=>e.node===o);c&&w(c)&&requestAnimationFrame(()=>j(e,c))};return e.content.node.addEventListener("mousedown",t,!0),e.content.node.addEventListener("click",t,!0),e.content.node.addEventListener("dblclick",t,!0),()=>{e.content.node.removeEventListener("mousedown",t,!0),e.content.node.removeEventListener("click",t,!0),e.content.node.removeEventListener("dblclick",t,!0)}})(t),h=new MutationObserver(()=>{a()});h.observe(t.content.node,{childList:!0,subtree:!0}),t.disposed.connect(()=>{l.dispose(),t.content.activeCellChanged.disconnect(d),s&&r&&s.changed.disconnect(r),p(),h.disconnect()}),t.context.ready.then(()=>{I(t),i(),a()})})}},b=v}}]);